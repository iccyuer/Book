/**
 * Created by 魏汉清 on 2015/6/25.
 * Edited by 杨骏 on 2016/06/02.
 */$(document).ready(function(){function e(a){var c=new Image,d=a.attr("imgsrc");c.onload=function(){1==c.complete&&(a.attr("src",d),a.removeClass("lazy"),a.removeAttr("imgsrc"))};c.src=d}FastClick.attach(document.body);changeContent();$(".tab li").on("click",function(){$(".tab .on").removeClass("on");$(this).addClass("on");changeContent()});window.onscroll=function(){$(".lazy").each(function(){e($(this))})};$(".goTop").off("click").on("click",function(){window.scrollTo(0,0)});window.onscroll=function(){var a=document.body.scrollTop||document.documentElement.scrollTop,c=$(window).height(),d=$(".goTop"),b=$(".top")[0];if(a=a>c)b&&1===b.nodeType?(b=b.getBoundingClientRect(),b=0>b.bottom?!1:b.top<Math.max(window.innerHeight,document.documentElement.clientHeight)):b=!1,a=!b;a?d.css("display","block"):d.css("display","none")}});var area=$(".j_area").length?$(".j_area"):$(".area"),changeContent=function(){area.hide();$("[data-content-name\x3d"+$(".tab .on").data("title-name")+"]").show();"\u4e3a\u4f60\u63a8\u8350"==$(".tab .on").data("title-name")&&0==$("#recommendList").length&&getRecommend()};function getRecommend(){var e="1"==is_book?"book":"mall";$(".loading").css("display","block");$.ajax({url:"h5ajax.php?action\x3d"+e+"-product-detail",typr:"GET",data:{pid:pid,categoryId:category_id,request_id:""},dataType:"json",success:function(a){console.log(a);if(0==a.errorCode){var c=function(a){var b=new Image,c=a.attr("imgsrc");b.onload=function(){1==b.complete&&(a.attr("src",c),a.removeClass("lazy"),a.removeAttr("imgsrc"))};b.src=c};if(a.reco_list&&0<a.reco_list.length){a.recoFlag=!0;a.product_list=a.reco_list;var d=_.template('\x3cul id\x3d"\x3c%\x3d recoFlag? "recommendList":"" %\x3e" request_id\x3d\x3c%\x3d request_id? request_id : "" %\x3e \x3e\n\x3c% _.each(product_list, function(elem){ %\x3e\n\x3cli data-id\x3d"\x3c%\x3d elem.product_id %\x3e"\x3e\n\x3ca href\x3d"\x3c%\x3d elem.product_id %\x3e.html" dd_name\x3d"\u4e3a\u4f60\u63a8\u8350-\u8fdb\u5355\u54c1"\x3e\n\x3caside\x3e\n\x3cimg class\x3d"lazy" src\x3d"coreimages/bg_pic.png" imgsrc\x3d"\x3c%\x3d elem.image_url%\x3e" /\x3e\n\x3c/aside\x3e\n\x3cspan\x3e\x3c%\x3d elem.name %\x3e\x3c/span\x3e\n\x3cdiv class\x3d"price_line"\x3e\n\x3cem class\x3d"money"\x3e\u00a5\x3c%\x3d elem.price %\x3e\x3c/em\x3e\n\x3c% if(elem.shop_id \x3d\x3d "0"){ %\x3e\n\x3cem class\x3d"dd_icon"\x3e\u5f53\u5f53\u81ea\u8425\x3c/em\x3e\n\x3c% } %\x3e\n\x3c/div\x3e\n\x3cp class\x3d"commentNum"\x3e\x3c%\x3d elem.review_count? "0" : elem.review_count %\x3e\u4eba\u8bc4\u4ef7\x3c/p\x3e\n\x3c/a\x3e\n\x3c/li\x3e\n\x3c% }) %\x3e\n\x3c/ul\x3e',a),b='\x3cdiv class\x3d"recomment_title"\x3e\x3cspan\x3e'+("1"==is_book?"\u4e70\u4e86\u53c8\u4e70":"\u5e97\u94fa\u63a8\u8350")+"\x3c/sapn\x3e\x3c/div\x3e";$(".j_recommendDiv").append(b).append(d)}a.ad_list&&0<a.ad_list.length&&(a.recoFlag=!1,a.product_list=a.ad_list,a=_.template('\x3cul id\x3d"\x3c%\x3d recoFlag? "recommendList":"" %\x3e" request_id\x3d\x3c%\x3d request_id? request_id : "" %\x3e \x3e\n\x3c% _.each(product_list, function(elem){ %\x3e\n\x3cli data-id\x3d"\x3c%\x3d elem.product_id %\x3e"\x3e\n\x3ca href\x3d"\x3c%\x3d elem.product_id %\x3e.html" dd_name\x3d"\u4e3a\u4f60\u63a8\u8350-\u8fdb\u5355\u54c1"\x3e\n\x3caside\x3e\n\x3cimg class\x3d"lazy" src\x3d"coreimages/bg_pic.png" imgsrc\x3d"\x3c%\x3d elem.image_url%\x3e" /\x3e\n\x3c/aside\x3e\n\x3cspan\x3e\x3c%\x3d elem.name %\x3e\x3c/span\x3e\n\x3cdiv class\x3d"price_line"\x3e\n\x3cem class\x3d"money"\x3e\u00a5\x3c%\x3d elem.price %\x3e\x3c/em\x3e\n\x3c% if(elem.shop_id \x3d\x3d "0"){ %\x3e\n\x3cem class\x3d"dd_icon"\x3e\u5f53\u5f53\u81ea\u8425\x3c/em\x3e\n\x3c% } %\x3e\n\x3c/div\x3e\n\x3cp class\x3d"commentNum"\x3e\x3c%\x3d elem.review_count? "0" : elem.review_count %\x3e\u4eba\u8bc4\u4ef7\x3c/p\x3e\n\x3c/a\x3e\n\x3c/li\x3e\n\x3c% }) %\x3e\n\x3c/ul\x3e',a),$(".j_recommendDiv").append('\x3cdiv class\x3d"recomment_title"\x3e\x3cspan\x3e\u63a8\u5e7f\u5546\u54c1\x3c/sapn\x3e\x3c/div\x3e').append(a));$(".lazy").each(function(){c($(this))});CC.cctab({reco_id:"recommendList",main_pid:pid,product_type:e})}0==$(".j_recommendDiv ul").length&&$(".j_recommendDiv").html('\x3csection  class\x3d"area empty emptyRecommend" style\x3d"display:block;background-color:white;"\x3e\x3cp\x3e\u5c0f\u5f53\u6ca1\u6709\u66f4\u591a\u63a8\u8350\u4e86\uff0c\u5f53\u524d\u8fd9\u4e2a\u5546\u54c1\u66f4\u9002\u5408\u4f60\uff0c\u5feb\u52a0\u5165\u8d2d\u7269\u8f66\u5427\x3c/p\x3e\x3c/section\x3e')},error:function(a){$(".j_recommendDiv").html('\x3csection  class\x3d"area empty emptyRecommend" style\x3d"display:block;background-color:white;"\x3e\x3cp\x3e\u5c0f\u5f53\u6ca1\u6709\u66f4\u591a\u63a8\u8350\u4e86\uff0c\u5f53\u524d\u8fd9\u4e2a\u5546\u54c1\u66f4\u9002\u5408\u4f60\uff0c\u5feb\u52a0\u5165\u8d2d\u7269\u8f66\u5427\x3c/p\x3e\x3c/section\x3e')},complete:function(){$(".loading").css("display","none")}})};